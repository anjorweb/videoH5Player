/*!
 * VERSION: 0.1.0
 * DATE: 2017-8-20
 * GIT: https://github.com/anjorweb/videoH5Player
 * @author: anjorfu
 **/
 
!function(e){"function"==typeof define&&define.amd?define(["exports"],function(i){window.h5VideoPlayer=e(i)}):"undefined"!=typeof exports?e(exports):window.h5VideoPlayer=e({})}(function(e){return e=function(){this.initialize.apply(this,arguments)},e.prototype={_video:null,_w:0,_h:0,_timeArr:[],_sectionTimeId:0,_curSectionTimeId:0,_curVideoTime:0,initialize:function(e){var i=e||{},t=this;t._video=document.createElement("video"),t._video.src=i.src,t._video.poster=i.poster,t._video.setAttribute("x-webkit-airplay","true"),t._video.setAttribute("webkit-playsinline","true"),t._video.setAttribute("airplay","allow"),t._video.setAttribute("playsinline","allow"),t._video.setAttribute("x5-video-player-fullscreen","true"),t._video.setAttribute("x5-video-player-type","h5"),t._video.preload="auto",t._video.style.display="block",t._w=window.innerWidth,t._h=window.innerHeight,i.el?document.querySelector(i.el).appendChild(t._video):document.body.appendChild(t._video),i.width||(t._video.width=t._w,t._video.height=t._h),t._handle()},_resize:function(){var e=this;e._w=window.innerWidth,e._h=window.innerHeight,e._video.width=e._w,e._video.height=e._h},_handle:function(){var e=this;window.addEventListener("resize",function(){e._resize()}),e.addEvent("timeupdate",function(){e._update()})},play:function(){this._video.play()},destory:function(e){var i=this;console.dir(i._video.parentNode),e&&i._video.parentNode.removeChild(i._video),i.addScript=null,i.addEvent=null,i.nextSection=null,i._update=null,i.play=null,i._handle=null,i._resize=null,i.initialize=null,i._curVideoTime=null,i._timeArr=null},addScript:function(e,i,t){var n=this;if(e.constructor===Array&&i.constructor===Function&&t.constructor===Function){if(2!=e.length)return console.error("时间段错误");n._timeArr[n._sectionTimeId]={id:n._sectionTimeId,times:e,_beforeIsRun:!1,_afterIsRun:!1,before:i,after:t}}else console.error("addScript参数错误");n._sectionTimeId++},addEvent:function(e,i){this._video.addEventListener(e,i)},nextSection:function(){var e=this;e._timeArr[e._curSectionTimeId]=null,e._curSectionTimeId++},_update:function(){var e=this;e._curVideoTime=e._video.currentTime.toFixed(2);for(var i=0;i<e._timeArr.length;i++){var t=e._timeArr[i];if(t&&(e._curVideoTime>t.times[0]&&!t._beforeIsRun&&(t._beforeIsRun=!0,t.before()),e._curVideoTime>t.times[1])){e._video.currentTime=t.times[0],t._afterIsRun||(t._afterIsRun=!0,t.after());break}}},animate:function(e){var i=this;requestAnimationFrame(i.animate.bind(this))}},e});